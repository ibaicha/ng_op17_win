import { createFeatureSelector, createSelector } from '@ngrx/store';

import { IExploitationState } from './exploitation.model';
import { IExploitation } from '../../interfaces/exploitation.interface';

export const selectExploitationState = createFeatureSelector<IExploitationState>('exploitation');
export const selectExploitationsList = createSelector(selectExploitationState, (state) => state.exploitations);
export const selectExploitationIsLoading = createSelector(selectExploitationState, (state) => state.isLoading);


export const selectExploitationById = (itemId: number) => createSelector(selectExploitationState, (state) => state.exploitations.find((item) => item.id === itemId));

export const selectExploitationByFilter = (idAnnee: number, idSaison: number, idProduit: number) =>
createSelector(
  createFeatureSelector<IExploitationState>('exploitation'),
  (state) => {
    if (state && state.exploitations) {
      const exploitations = state.exploitations.filter(exploitation => exploitation.annee.id === idAnnee && exploitation.saison.id === idSaison && exploitation.variete.produit.id === idProduit);
      console.log('exploitations: ', exploitations);
      /*
      let saisonValue = '';
      if(idSaison.toString().length === 1) {
        saisonValue = '0' + idSaison.toString();
      } else {
        saisonValue = idSaison.toString();
      }
      */

      let compteValue = 0;

      if(exploitations.length > 0) {

        let mostWins = Math.max(...exploitations.map((p) => p.compte));
        console.log(' mostWins before: ', mostWins);
        mostWins = mostWins + 1;
        console.log(' mostWins after: ', mostWins);

        compteValue = mostWins;
      } else {
        compteValue = parseInt(idAnnee.toString() + idSaison.toString() + idProduit.toString() + '00001', 10)

      }
      return compteValue;

    } else {
      return null ;
    }
  }
);



